{% load static %}
<!--------------------- chatbot html start here ---------------------->
<div class="wrapper-chat">
    <div class="marvel-device nexus5" id="chat-bubble">
        <div class="screen">
        <div class="screen-container">

            <div class="chat-header" onclick="openChatBubble()">
            <div class="user-details">
                <img alt="gravater" class="dp" src={% static '/images/favicon.png' %}>
                <div class="detail-txt">
                    <span class="username">
                        MedHouse
                    </span>
                </div>
            </div>

            <div class="chat-options" onclick="openChatBubble()">
                <span> 
                    <i class="tf-ion-close-round"></i> 
                </span>
            </div>
            </div>

            <div class="chat-screen">
            <div class="chat">
                <!-- BEGINING OF MESSAGE-->
                <div class="container1 fixed rev">
                <ul class="message-body">
                    
                </ul>

                </div>
                <!-- END OF MESSAGE -->

                <!-- BEGINING OF INPUT BOTTOM -->
                <div class="chat-footer">
                <div class="bottom">
                    <form class="form">
                    <div class="sendMess" id="userInput ">
                        <button class="attachment"><i class="tf-ion-person"></i></button>
                        <textarea id="text" name="text" cols="20" rows="3" placeholder="enter your message">
                        </textarea>
                        <button class="send"><i class="tf-ion-android-send"></i></button>
                    </div>
                    </form>
                </div>
                </div>
                <!-- END OF INPUT BOTTOM-->
            </div>
            </div>
        </div>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>  
//chat bot

    let counter = 0;
    const chatContainer = document.querySelector(".container");
    const chatArea = document.querySelector(".message-body");
    const text = document.querySelector("#text");
    const form = document.querySelector(".form");
    
    function getBotResponse() {
          var rawText = $("#text").val();
          var userHtml = '<p class="userText"><span>' + rawText + "</span></p>";
          $("#text").val("");
          $(".message-body").append(userHtml);
          document
            .getElementById("userInput")
            .scrollIntoView({ block: "start", behavior: "smooth" });
          $.get("/get", { msg: rawText }).done(function(data) {
            var botHtml = '<p class="botText"><span>' + data + "</span></p>";
            $("#.message-body").append(botHtml);
            document
              .getElementById("userInput")
              .scrollIntoView({ block: "start", behavior: "smooth" });
          });
    }
    $("#text").keypress(function(e) {
        if (e.which == 13) {
        getBotResponse();
        }
    });
    function openChatBubble() {
        var element = document.getElementById("chat-bubble");
        element.classList.toggle("open")
        }
        function isOverflown(element) {
        return (
          element.scrollHeight > element.clientHeight ||
          element.scrollWidth > element.clientWidth
        );
    }
     
    
    function scroll() {
        chatArea.scroll(0,chatArea.scrollHeight);
    }

    function reply(msg) {
    let li = document.createElement("li");
    li.innerHTML = msg;
    li.classList.add("chatbox");
    li.classList.add("chatbox-incoming");
    chatArea.append(li);
    scroll();
    }


    //EVENT LISTENERS
    text.addEventListener("focus", () => {
    chatContainer.scrollTop = chatArea.scrollHeight + 560;
    });



    form.addEventListener("submit", e => {
        e.preventDefault();
        msg = text.value;
        let li = document.createElement("li");
        li.innerHTML = msg;
        li.classList.add("chatbox");
        li.classList.add("chatbox-outgoing");
        chatArea.append(li);
        scroll();
        text.value = "";
        chatContainer.scrollTop =chatContainer.scrollHeight;
        text.focus();
        setTimeout(reply, 1000, messages[counter]);
        counter++;
        if (counter == messages.length) {
        counter = 0;
        }
    });


    window.onload = ()=>{
    reply("hi please type a message for me")
    }

    //buble body
    const body = document.querySelector('body');

    

    form.addEventListener("keyup", function(event) {
    if (event.keyCode === 13) {
    msg = text.value;
    let li = document.createElement("li");
    li.innerHTML = msg;
    li.classList.add("chatbox");
    li.classList.add("chatbox-outgoing");
    chatArea.append(li);
    scroll();
    text.value = "";
    chatContainer.scrollTop =chatContainer.scrollHeight;
    text.focus();
    setTimeout(reply, 1000, messages[counter]);
    counter++;
    if (counter == messages.length) {
    counter = 0;
    }
    }
    });

    
</script>
